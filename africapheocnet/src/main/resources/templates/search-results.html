<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="header :: head"></head>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<body data-topbar="dark">
    <header th:replace="header :: page-topbar"></header>
    <div th:replace="sidebar :: menu"></div>

    <div class="main-content">
        <div class="page-content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                               <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                   <h5 class="card-title">Member List <span class="text-muted fw-normal ms-2" th:text="|(${totalMembers})|"></span></h5>

                                                </div>
                                            </div><!-- end col -->
                
                                            <div class="col-md-6">
                                                <div class="d-flex flex-wrap align-items-start justify-content-md-end mt-2 mt-md-0 gap-2 mb-3">
                                                    <div class="row">
													    <div class="col-sm-6">
														    <form id="searchForm">
														        <div class="input-group mb-3">
														            <input type="text" class="form-control" id="searchInput" name="query" placeholder="Search for a member" aria-label="Search" aria-describedby="search-button">
														            <button class="btn btn-outline-secondary" type="submit" id="search-button">Search</button>
														        </div>
														    </form>
														</div>
														<div class="col-sm-6">
															<div class="input-group mb-3"><button id="viewAllButton" class="btn btn-primary">View All Members</button></div>
														</div>
													    <div class="col-sm-6">
													        <div class="btn-group" role="group" aria-label="Filter by Expertise">
													            <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
													                Filter by Expertise
													            </button>
													             <div class="dropdown-menu" id="filterDropdown">
													                <a class="dropdown-item" href="#">Expertise 1</a>
													                <a class="dropdown-item" href="#">Expertise 2</a>
													                <a class="dropdown-item" href="#">Expertise 3</a>
													                <!-- Add more expertise options as needed -->
													            </div>
													        </div>
													    </div>
													</div>
                                                    
												
                                                </div>
                                            </div><!-- end col -->
                                        </div><!-- end row -->
                              <div class="row">
                              
                              	<div class="row">
							    <div th:each="member, memberIndex : ${members}" class="col-xl-4 col-sm-6" th:if="${memberIndex.index >= startEntry - 1 and memberIndex.index < endEntry}">
							        <div class="card">
							            <div class="card-body p-4">
							            <div id="memberListContainer">
										     
										</div>
							                <div class="d-flex align-items-start">
							                    <div class="flex-shrink-0 avatar rounded-circle me-3">
							                        <div th:if="${member.photo != null}">
							                            <img th:src="@{'data:image/jpeg;base64,' + @{#memberController.byteArrayToHexString(member.photo)}}" alt="Member Photo" class="img-fluid rounded-circle">
							                        </div>
							                        <div th:unless="${member.photo != null}" class="rounded-circle" style="width: 50px; height: 50px; background-color: #9370DB; color: white; text-align: center; line-height: 50px;">
							                            <span th:text="${member.firstName[0]} + ${member.lastName[0]}"></span>
							                        </div>
							                    </div>
							                    <div class="flex-grow-1 overflow-hidden">
							                        <h5 class="font-size-15 mb-1 text-truncate"><a href="pages-profile.html" class="text-reset" th:text="${member.firstName} + ' ' + ${member.lastName}"></a></h5>
							                        <span class="badge bg-success-subtle text-success mb-0" th:text="${member.expertise}"></span>
							                    </div>
							                    <div class="flex-shrink-0 dropdown">
							                        <!-- Dropdown for actions -->
							                        <!-- ... -->
							                    </div>
							                </div>
							                <br>
							                <div class="pt-2">
							                    <button type="button" class="btn btn-soft-primary btn-sm w-md text-truncate"><i class="bx bx-user me-1 align-middle"></i> Contact</button>
							                    <button type="button" class="btn btn-primary btn-sm w-md text-truncate ms-2"><i class="bx bx-message-square-dots me-1 align-middle"></i> Profile</button>
							                </div>
							            </div>
							        </div>
							    </div>
							</div>

                              
                              </div>

							
							
							</div>

                    
               </div>
                            </div>
                            <!-- end card body -->
                        </div>
                        <!-- end card -->
                    </div>
                    <!-- end col -->
                </div>
            </div>
       
    <footer th:replace="footer :: footer-content"></footer>
    <footer th:replace="rightbar :: right-bar"></footer>
    
    <!-- JAVASCRIPT -->
    <script th:src="@{/libs/bootstrap/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/libs/metismenujs/metismenujs.min.js}"></script>
    <script th:src="@{/libs/simplebar/simplebar.min.js}"></script>
    <script th:src="@{/libs/feather-icons/feather.min.js}"></script>
   <script type="text/javascript">
    $(document).ready(function() {
        // Handle form submission
        $("#searchForm").submit(function(event) {
            event.preventDefault(); // Prevent the default form submission behavior

            var query = $("#searchInput").val().trim(); // Get and trim the search query from the input field

            // Check if the query is empty
            if (!query) {
                alert("Please enter a search query."); // Display alert if the query is empty
                return; // Exit the function
            }

            // Perform the AJAX request
            $.ajax({
                type: "GET",
                url: "/members/search", // Replace with your actual search endpoint
                data: { query: query },
                success: function(data) {
                    // Check if the response data is empty or not
                    if (data.trim().length === 0) {
                        // Handle the case where no members are found
                        $("#memberListContainer").html("<p>No member has been found with that name.</p>");
                    } else {
                        // Update the member list with the response data
                        $("#memberListContainer").html(data);
                    }
                },
                error: function(xhr, textStatus, errorThrown) {
                    console.error("AJAX Error: ", textStatus, errorThrown, xhr);
                }
            });
        });
    });
    
    
    
    // Handle the "View All" button click
    $("#viewAllButton").click(function() {
        $.ajax({
            type: "GET",
            url: "/members/list", // Replace with the endpoint that returns all members
            success: function(data) {
                // Update the member list with all members
                $("#memberListContainer").html(data);
            },
            error: function(error) {
                console.error("Error loading all members:", error);
                $("#memberListContainer").html("<p>Error occurred while loading members. Please try again.</p>");
            }
        });
    });
</script>
   
   
  
    
</body>
</html>
